From 24298027a30cf7941f16a8cc878d0c1f9f14308f Mon Sep 17 00:00:00 2001
From: "D. Richard Hipp" <drh@hwaci.com>
Date: Sat, 3 Nov 2018 13:11:24 +0000
Subject: [PATCH] Fix a assert() in the query planner that can arise when
 doing row-value operations on a PRIMARY KEY that contains
 duplicate columns. Ticket [1a84668dcfdebaf12415d].

---
 sqlite3.c    |    2 +-
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/sqlite3.c b/sqlite3.c
index f337006..e371cb8 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -131231,7 +131231,7 @@ static Expr *removeUnindexableInClauseTe
     for(i=iEq; i<pLoop->nLTerm; i++){
       if( pLoop->aLTerm[i]->pExpr==pX ){
         int iField = pLoop->aLTerm[i]->iField - 1;
-        assert( pOrigRhs->a[iField].pExpr!=0 );
+        if( pOrigRhs->a[iField].pExpr==0 ) continue; /* Duplicate PK column */
         pRhs = sqlite3ExprListAppend(pParse, pRhs, pOrigRhs->a[iField].pExpr);
         pOrigRhs->a[iField].pExpr = 0;
         assert( pOrigLhs->a[iField].pExpr!=0 );
-- 
1.7.9.5

